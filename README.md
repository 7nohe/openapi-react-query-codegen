# OpenAPI React Query Codegen

> Code generator for creating [React Query (also known as TanStack Query)](https://tanstack.com/query) hooks based on your OpenAPI schema.

[![npm version](https://badge.fury.io/js/%407nohe%2Fopenapi-react-query-codegen.svg)](https://badge.fury.io/js/%407nohe%2Fopenapi-react-query-codegen)

## Features

- Generates custom react hooks that use React Query's `useQuery`, `useSuspenseQuery`, `useMutation` and `useInfiniteQuery` hooks
- Generates custom functions that use React Query's `ensureQueryData` and `prefetchQuery` functions
- Generates query keys and functions for query caching
- Generates pure TypeScript clients generated by [@hey-api/openapi-ts](https://github.com/hey-api/openapi-ts)
- Generates loader factories and helpers for [TanStack Router](https://tanstack.com/router) integration

## TanStack Router Integration

The generated `router.ts` file provides loader factories and helpers for seamless integration with TanStack Router.

### Using Loader Factories

Use `loaderUse*` functions in your route definitions to prefetch data:

```tsx
// routes/pets.$petId.tsx
import { createFileRoute } from "@tanstack/react-router";
import { loaderUseFindPetById } from "../openapi/queries/router";
import { queryClient } from "../queryClient";

export const Route = createFileRoute("/pets/$petId")({
  loader: ({ params }) =>
    loaderUseFindPetById({ queryClient })({
      params: { petId: Number(params.petId) },
    }),
  component: PetDetail,
});
```

For SSR/TanStack Start, pass `queryClient` from the router context:

```tsx
loader: ({ context, params }) =>
  loaderUseFindPetById({ queryClient: context.queryClient })({
    params: { petId: Number(params.petId) },
  }),
```

### Using withQueryPrefetch for Hover/Touch Prefetching

The `withQueryPrefetch` helper enables prefetching on hover or touch:

```tsx
import { withQueryPrefetch } from "../openapi/queries/router";
import { prefetchUseFindPetById } from "../openapi/queries/prefetch";
import { queryClient } from "../queryClient";

function PetLink({ petId }: { petId: number }) {
  return (
    <a
      href={`/pets/${petId}`}
      {...withQueryPrefetch(() =>
        prefetchUseFindPetById(queryClient, { path: { petId } })
      )}
    >
      View Pet
    </a>
  );
}
```

### Important Notes

- **Router params are strings**: TanStack Router params are always strings. You must parse them to the correct type (e.g., `Number(params.petId)`) before passing to the loader.
- **External cache configuration**: When using TanStack Query as the cache, set `defaultPreloadStaleTime: 0` in your router configuration to let React Query handle cache freshness:

```tsx
const router = createRouter({
  routeTree,
  defaultPreloadStaleTime: 0,
});
```

- **Link preloading**: When using `<Link preload="intent">` or `defaultPreload: "intent"`, TanStack Router will automatically call the route's `loader` on hover/touch. If your loader uses `ensureUse*Data`, prefetching happens automatically without needing `withQueryPrefetch`.
